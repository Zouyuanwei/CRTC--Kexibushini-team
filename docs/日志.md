# CRTC-可惜不是你队-双车开发日志

## 一、预准备期（9.20-9.30）：技术能力奠基与分工规划
报名参赛后，团队基于“机械硬件落地+电控软件驱动”的全流程需求，针对性开展分工式能力建设。机械组聚焦焊接工艺与Fusion 360建模工具学习——焊接是硬件结构稳定性的核心保障，Fusion 360可实现复杂机械结构，如收集装置的精准建模，为后续3D打印提供设计依据；电控组主攻STM32开发环境配置与C语言入门，STM32具备足够算力支撑多硬件任务调度，C语言的底层操控性可满足硬件驱动的高效性需求。通过分层学习，团队在机械加工与电控开发维度建立基础能力，为整车开发筑牢技术根基。


## 二、方案设计阶段（10.1-10.7）：多方案对比与系统架构决策
因假期时间冲突，团队通过两次线上会议完成初步对小车效果的讨论。针对“小球采集”双任务需求，团队提出两类方案：
- 方案一：单车集成双功能，通过机械结构切换实现任务切换；
- 方案二：两车分工，1号车专攻收集、2号车专攻小球采集；

**经技术可行性、效率上限、操作复杂度三维对比**：方案一因机械结构切换延迟高、故障率高被排除；最终选定**两车分工方案**——该方案对操作手协同要求高，但“收集+采集”并行作业效率比单车方案提升较高，且功能模块独立设计让技术迭代更具针对性，具备长期优化的潜力。

同期，团队启动**物料采购与技术预研**：基于两车方案完成ps2、舵机、驱动板、固定螺丝等工具的采购；针对STM32开展GPIO、定时器、串口通信基础实验，验证“电机驱动+手柄控制”初步功能，为硬件组装阶段的系统集成降低风险。


## 三、硬件组装阶段（10.8-10.16）：从理论构建到问题迭代解决
### （一）理论构建：模块化布局与3D打印设计
1. **底盘功能区块规划**：在旧底盘基础上，团队基于“空间高效利用”原则，对底板进行模块化分区——降压模块负责电源适配、STM32承担控制核心、电机驱动模块专管动力输出。明确的功能区块划分避免了电路干扰与后期维护混乱，防止后续因电路问题而产生的调试受阻（虽然最后还是发生了这样的情况。。。耽搁了一下午进行无意义的软件调试，而忽略的线路的问题）。
2. **3D打印模块设计**：针对1号车收集装置与2号车小球接收装置，通过Fusion 360完成模型构建。设计时重点考虑**兼容性与结构强度**：提升小球收集稳定性，接收装置优化入球通道倾角，以确保小球快速收集；选用PLA+材料提升打印件耐磨与承重性能，避免赛事中结构失效。


### （二）实践组装：问题驱动的迭代优化
1. **电路板与底盘的分层架构**：
   初期“平面堆叠”安装导致硬件空间冲突，团队引入铜柱分层方案———通过不同高度铜柱将底盘与电路板板拆分为上下两层，上层布置控制单元，下层容纳电源与动力模块。该设计解决了空间拥挤问题，还实现了“散热+支撑”的双重优化，使整车结构层次清晰、维护便捷。

2. **电机安装的尺寸合规性迭代**：
   旧底板宽度超标是首个硬件难题。初次安装电机后整车宽度超限，团队经历三次迭代：
   - 迭代1：直接打磨底板边缘，收效微乎其微，间距并没有显著减小；
   - 迭代2：更换小型化电机，动力输出不足；
   - 迭代3：“手工切割+电机位精准校准”——对底板电机区域精细化打磨，调整电机固定孔位间距，最终整车宽度合规且电机扭矩未受损失。同时联动电控组优化电机驱动逻辑，确保尺寸合规后仍实现全向移动。

3. **线路梳理的可靠性升级**：
   初期线路裸露杂乱导致调试耗时，我们便实施以下手段:
   - 红/黑区分电源正负极、黄/蓝区分信号与地线，实现线路功能可视化；
   - 电机线路用胶枪固定，避免转动时拉扯导致接触不良；
   - 关键信号线路采用热缩管固定。   
   该方案使线路复杂度降低，减小了后期硬件类报错。


## 四、代码编译阶段（10.12-10.20）：对于CubeMX+keil的综合运用
### （一）PS2手柄的通信与控制逻辑
团队**基于“稳定性+扩展性”选择双灯PS2手柄**——相比单灯手柄，双灯型号通信协议更稳定，依次避免赛事中信号丢失失控，且支持更多按键自定义。通过网课的学习，实现手柄按键与电机动作绑定，随后通过调试，提升操控灵活性。


### （二）电机驱动的PWM精准调控
采用“Keil+CubeMX”进行开发：CubeMX用于图形化配置STM32时钟、引脚与定时器生成PWM，降低初始化代码出错率；Keil用于编写电机控制逻辑，通过调整PWM占空比，实现电机速度线性调控。

### （三）多模块代码的集成与兼容
初期因开发环境差异，如库版本、命名规范不统一等问题，造成代码集成报错，团队**通过“标准化流程+版本管理”解决**：
- 统一采用STM32标准外设库，避免CubeMX生成代码兼容问题；
- 制定变量命名规范，确保模块间调用可读性；
- 引入条件判断语句，实现手柄与硬件动作绑定。     
经多次调试，最终完成“PS2手柄→STM32→电机”全链路控制整合。


## 五、代码调试阶段（10.20-10.25）：功能验证与问题修正  
本阶段以“让各模块协同稳定运行”为核心目标，通过简单有效的调试手段排查问题，最终实现小车功能符合预期。  


### 调试手段  
1. **串口打印监控数据**：在代码中加入串口打印语句，实时输出PS2手柄的按键信号、电机PWM值等关键数据。通过观察数据变化，快速定位“信号传输中断”“参数异常”等问题。  
2. **分模块单独测试**：将电机、舵机、手柄控制代码拆分为独立小程序，逐一连接硬件测试。先确保单个模块能稳定响应，再逐步整合，避免“多模块混测”导致的问题定位困难。  

3. **达成调试目标**：经最终测试，小车能通过PS2手柄精准完成前进、转向、原地旋转等运动。
